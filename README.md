Я захардкодил последний рабочий конфиг от Flowseal на [этом коммите](https://github.com/Flowseal/zapret-discord-youtube/commit/7e723f0a3f7185af1425b93938a56401a1e6b286).

Если текущая версия не работает, вы можете попробовать скачать прошлые [стабильные релизы](https://github.com/Sergeydigl3/zapret-discord-youtube-linux/releases).

Обновляю скрипт редко, для поддержания работоспособности относительно версии для Win. То бишь, пока не происходит массовых отказов всех стратегий.

Также можете попробовать [эту](https://github.com/Snowy-Fluffy/zapret.installer) версию от Snowy-Fluffy

# Что это?

Это адаптер для запуска популярных конфигураций обхода замедления YouTube  
на базе [Zapret Discord Youtube Flowseal](https://github.com/Flowseal/zapret-discord-youtube).  
Скрипт создан за пару вечеров с целью сделать его Plug-And-Play.

**Проверено на:**  
- Ubuntu 24.04
- Arch Linux

---

# Как запустить

1. **Клонирование репозитория и запуск основного скрипта:**

   ```bash
   git clone https://github.com/Sergeydigl3/zapret-discord-youtube-linux.git && cd zapret-discord-youtube-linux
   sudo bash main_script.sh
   ```
> [!IMPORTANT]
> Issues - предназначен для связи со мной как с разработчиком, в случае ошибок в работе скрипта, и для вопросов по его работе. 
> Это АДАПТЕР! Он не дает вам гарантию, что стратегии вам подойдут и все разблокируют. Если у вас не работает ни одна из стратегий - то не нужно идти сразу в Issues и писать что у вас не работает ютуб. Нужно создать тред в Discussions или написать в существующий, а лучше сходить в репозиторий выше (Flowseal), и посмотреть что предлагают другие. Если же вы нашли ультимативную стратегию и хотите, чтобы я её добавил в custom-strategies, спокойно создавайте Issue, надеюсь на понимание.
>

   Скрипт:
   - Подкачает в zapret-latest стратегии указанные в ревизии.
   - Предложит выбрать стратегию из bat-файлов (например, `general.bat`, `general_mgts2.bat`, `general_alt5.bat`).  
     (При этом bat-файлы автоматически переименовываются через `rename_bat.sh`.)
   - Попросит выбрать сетевой интерфейс.

2. **Сохранение параметров:**

   Ответы можно сохранить в файле `conf.env` и потом запускать скрипт в неинтерактивном режиме:
   
   ```bash
   sudo bash main_script.sh -nointeractive
   ```
   
   Для отладки парсинга используйте флаг `-debug`.

   Пример содержимого файла `conf.env`:
   
   ```bash
   strategy=general.bat
   interface=enp0s3
   gamefilter=true
   ```
   
   > **Примечание:** Если требуется автообновление, установите auto_update=true.

3. **Как посмотреть список интерфейсов:**

   ```bash
   ls /sys/class/net
   ```

4. **Управление через CLI:**

   Скрипт `service.sh` также поддерживает командный интерфейс (CLI) для управления сервисом и конфигурацией. Список всех комманд доступен по `bash ./service.sh --help`.
   
   Примеры изменения конфигурации:
   
   ```bash
   bash ./service.sh general.bat enp0s3
   # strategy=general.bat
   # gamefilter=false
   # interface=enp0s3
   
   bash ./service.sh --gamefilter alt11
   # interface=any
   # gamefilter=true
   # strategy=general_alt11.bat
   ```

---

# Автоматический подбор стратегий для YouTube

Скрипт `auto_tune_youtube.sh` позволяет получить список рабочих стратегий для доступа к YouTube:

**Как работает:**

1. **Перебирает все доступные стратегии** из директорий:
   - `/custom-strategies` (пользовательские стратегии)
   - `/zapret-latest` (основные стратегии из репозитория Flowseal)
   
   *Важно:* Название стратегии должно начинаться на `general`

2. **Тестирует каждую стратегию** на доступ к YouTube

3. **Сохраняет результаты**:
   - Отображает в терминале список рабочих стратегий
   - Сохраняет в файл `auto_tune_youtube_results.txt`
   - Позволяет выбрать и запустить стратегию из списка успешных
   - Позволяет выбрать и сохранить стратегию из списка успешных в `conf.env`

**Использование:**
```bash
sudo bash auto_tune_youtube.sh
```
>[**Примечание:**]
>
>Функционал экспериментальный и достоверность списка не гарантирована. Фидбек приветствуется.

---

# Важно

- Скрипт работает только с **nftables**.
- При остановке скрипта все добавленные правила фаервола очищаются, а фоновые процессы `nfqws` останавливаются.
- Если у вас настроены кастомные правила в nftables, сделайте их резервное копирование — скрипт может удалить их при запуске.

---

# Автозагрузка

Для настройки автозагрузки сервиса запустите скрипт:

```bash
sudo bash service.sh
```

Скрипт service.sh теперь:
- Проверяет наличие файла `conf.env` и обязательных непустых полей.
- Если конфиг отсутствует или поля пустые (например, если у вас:
  ```
  strategy=
  interface=
  gamefilter=
  ```
  ), то предложит интерактивно выбрать параметры (интерфейс, стратегию из bat-файлов и gamefilter).
- Создаёт systemd-сервис для автозапуска.

Просмотреть статус сервиса можно командой:

```bash
systemctl status zapret_discord_youtube.service
```

Посмотреть логи сервиса:

```bash
journalctl -u zapret_discord_youtube.service
```

Значения для автозагрузки берутся из файла `conf.env`.

---

# Совет

- **Не включайте автоапгрейд.**  
  Если репозиторий [Flowseal/zapret-discord-youtube](https://github.com/Flowseal/zapret-discord-youtube) сильно изменится, возможны проблемы из-за костыльного кода парсинга)

---


# Поддержка

- Если есть идеи по улучшению — создавайте Pull Request (например, добавить поддержку iptables).
- Если что-то не работает в скрипте, не запускается, создавайте Issue (пожалуйста, не пишите в личные сообщения) — так мы сможем помочь как можно большему числу пользователей.
- Если у вас не работает сайт или приложение - создавайте [Discussion](https://github.com/Sergeydigl3/zapret-discord-youtube-linux/discussions)
